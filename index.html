<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stablecoin Issuers - Discovery Questionnaire</title>
    <style>
        :root {
            color-scheme: dark light;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            background: #0f3460;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 100%;
            padding: 40px;
            border: 1px solid #1a4d7a;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .header p {
            color: #b0b0b0;
            font-size: 14px;
        }

        /* Barra de Progresso */
        .progress-section {
            margin-bottom: 30px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #b0b0b0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #1a4d7a;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff 0%, #0099ff 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .part-badge {
            display: inline-block;
            background: #1a4d7a;
            color: #00d4ff;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        /* Pergunta */
        .question-section {
            margin-bottom: 30px;
        }

        .question-label {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 12px;
        }

        /* Tipos de resposta */
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #1a4d7a;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s;
            background: #1a3a52;
            color: #e0e0e0;
        }

        textarea::placeholder {
            color: #707070;
        }

        textarea:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #1a4d7a;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
            background: #1a3a52;
            color: #e0e0e0;
        }

        input[type="text"]::placeholder,
        input[type="number"]::placeholder {
            color: #707070;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .options-group {
            margin-top: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .option-item:hover {
            background: #1a4d7a;
        }

        .option-item input[type="radio"],
        .option-item input[type="checkbox"] {
            margin-right: 10px;
            cursor: pointer;
            accent-color: #00d4ff;
        }

        .option-item label {
            cursor: pointer;
            flex: 1;
            color: #e0e0e0;
        }

        /* Valida√ß√£o */
        .error-message {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 8px;
            display: none;
        }

        .field-error {
            border-color: #ff6b6b !important;
        }

        .field-error ~ .error-message {
            display: block;
        }

        /* Navega√ß√£o */
        .navigation {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            justify-content: space-between;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary {
            background: #1a4d7a;
            color: #e0e0e0;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #2a6da0;
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: #0f3460;
            flex: 1;
            font-weight: 700;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 212, 255, 0.3);
        }

        /* Tela de Sucesso */
        .success-screen {
            display: none;
            text-align: center;
        }

        .success-screen.active {
            display: block;
        }

        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 0.6s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .success-screen h2 {
            font-size: 28px;
            color: #ffffff;
            margin-bottom: 12px;
        }

        .success-screen p {
            color: #b0b0b0;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .btn-download {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: #0f3460;
            padding: 14px 32px;
            font-size: 16px;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 212, 255, 0.3);
        }

        .btn-restart {
            background: #1a4d7a;
            color: #e0e0e0;
            padding: 12px 24px;
        }

        .btn-restart:hover {
            background: #2a6da0;
        }

        /* Responsivo */
        @media (max-width: 600px) {
            .container {
                padding: 24px;
            }

            .header h1 {
                font-size: 20px;
            }

            button {
                padding: 10px 16px;
                font-size: 13px;
            }

            .navigation {
                flex-direction: column;
            }

            .btn-primary {
                flex: none;
                width: 100%;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Formul√°rio -->
        <div id="formScreen">
            <div class="header">
                <h1>üß© Stablecoin Issuers</h1>
                <p>Discovery Questionnaire</p>
            </div>

            <!-- Barra de Progresso -->
            <div class="progress-section">
                <div class="progress-info">
                    <span id="progressText">Pergunta 1 de 52</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Conte√∫do da Pergunta -->
            <div id="questionContainer"></div>

            <!-- Navega√ß√£o -->
            <div class="navigation">
                <button class="btn-secondary" id="btnPrevious" onclick="previousQuestion()">‚Üê Anterior</button>
                <button class="btn-primary" id="btnNext" onclick="nextQuestion()">Pr√≥xima ‚Üí</button>
            </div>
        </div>

        <!-- Tela de Sucesso -->
        <div id="successScreen" class="success-screen">
            <div class="success-icon">‚úÖ</div>
            <h2>Parab√©ns!</h2>
            <p>Voc√™ respondeu todas as perguntas do formul√°rio com sucesso.</p>
            <button class="btn-download" onclick="downloadCSV()">üì• Baixar Planilha (CSV)</button>
            <button class="btn-restart" onclick="restartForm()">üîÑ Come√ßar Novamente</button>
        </div>
    </div>

    <script>
        // ====== DEFINI√á√ÉO DAS PERGUNTAS ======
        const questions = [
            // PARTE 1: CONTEXTO DO NEG√ìCIO
            {
                id: "p1q1",
                part: "PARTE 1: CONTEXTO DO NEG√ìCIO",
                question: "Me conta sobre os tipos de ativos que a sua empresa tokeniza. Como funciona hoje?",
                type: "textarea",
                required: true
            },
            {
                id: "p1q2",
                part: "PARTE 1: CONTEXTO DO NEG√ìCIO",
                question: "Quantos clientes ativos voc√™s t√™m na plataforma?",
                type: "text",
                required: true
            },
            {
                id: "p1q3",
                part: "PARTE 1: CONTEXTO DO NEG√ìCIO",
                question: "Qual √© o perfil desses clientes? (tamanho, segmento, tipo de uso)",
                type: "textarea",
                required: true
            },
            {
                id: "p1q4",
                part: "PARTE 1: CONTEXTO DO NEG√ìCIO",
                question: "Quais s√£o os principais casos de uso da tokeniza√ß√£o que voc√™s oferecem hoje?",
                type: "textarea",
                required: true
            },

            // PARTE 2: ORIGEM DA IDEIA E PROBLEMA
            {
                id: "p2q1",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Como surgiu a ideia de oferecer emiss√£o de stablecoins para seus clientes?",
                type: "textarea",
                required: true
            },
            {
                id: "p2q2",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Foi demanda de algum cliente espec√≠fico ou voc√™s identificaram essa oportunidade internamente?",
                type: "radio",
                options: ["Demanda de clientes", "Identifica√ß√£o interna", "Ambos"],
                required: true
            },
            {
                id: "p2q3",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "[SE FOI DEMANDA] Quantos clientes j√° pediram isso explicitamente?",
                type: "text",
                required: false,
                dependsOn: "p2q2",
                dependsValue: ["Demanda de clientes", "Ambos"]
            },
            {
                id: "p2q4",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "[SE FOI DEMANDA] O que exatamente esses clientes pediram?",
                type: "textarea",
                required: false,
                dependsOn: "p2q2",
                dependsValue: ["Demanda de clientes", "Ambos"]
            },
            {
                id: "p2q5",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "[SE FOI DEMANDA] Que problema espec√≠fico esses clientes estavam tentando resolver?",
                type: "textarea",
                required: false,
                dependsOn: "p2q2",
                dependsValue: ["Demanda de clientes", "Ambos"]
            },
            {
                id: "p2q6",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Me explica melhor: que tipo de compliance √© necess√°rio e por que isso √© um impeditivo?",
                type: "textarea",
                required: true
            },
            {
                id: "p2q7",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Por que seus clientes querem emitir stablecoins? O que ganham com isso que n√£o t√™m hoje?",
                type: "textarea",
                required: true
            },
            {
                id: "p2q8",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Seus clientes j√° tentaram usar alternativas existentes? (USDC, USDT, Pix, TED etc.)",
                type: "radio",
                options: ["Sim", "N√£o", "N√£o sei"],
                required: true
            },
            {
                id: "p2q9",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "[SE SIM] Por que essas alternativas n√£o funcionaram?",
                type: "textarea",
                required: false,
                dependsOn: "p2q8",
                dependsValue: ["Sim"]
            },
            {
                id: "p2q10",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Se essa solu√ß√£o n√£o existisse, o que aconteceria com esses clientes?",
                type: "checkbox",
                options: ["Desistiriam da ideia", "Usariam outra solu√ß√£o", "Neg√≥cio em risco", "Continuariam igual", "Outro"],
                required: true
            },
            {
                id: "p2q11",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Como seus clientes movimentam dinheiro hoje? Descreva o fluxo completo.",
                type: "textarea",
                required: true
            },
            {
                id: "p2q12",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Quais as principais dores do processo atual?",
                type: "checkbox",
                options: ["Custos altos", "Lentid√£o", "Falta de rastreabilidade", "Problemas internacionais", "Compliance complexo", "Outro"],
                required: true
            },
            {
                id: "p2q13",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Quanto esse problema custa hoje (tempo, dinheiro, oportunidades perdidas)?",
                type: "textarea",
                required: true
            },
            {
                id: "p2q14",
                part: "PARTE 2: ORIGEM DA IDEIA E PROBLEMA",
                question: "Esse problema √© um nice to have ou must have?",
                type: "radio",
                options: ["Nice to have", "Must have", "N√£o sei"],
                required: true
            },

            // PARTE 3: SOLU√á√ÉO IMAGINADA
            {
                id: "p3q1",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Descreva como voc√™ imagina que a solu√ß√£o funcionaria (dep√≥sito ‚Üí resgate).",
                type: "textarea",
                required: true
            },
            {
                id: "p3q2",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Por que cada cliente precisa ter seu pr√≥prio token (ex: BRL1, BRL2)?",
                type: "textarea",
                required: true
            },
            {
                id: "p3q3",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Essa separa√ß√£o de tokens √©:",
                type: "radio",
                options: ["Requisito legal/regulat√≥rio", "Escolha t√©cnica", "Escolha de neg√≥cio", "N√£o sei", "Outro"],
                required: true
            },
            {
                id: "p3q4",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Onde os reais ficariam custodiados?",
                type: "radio",
                options: ["Conta da empresa", "Conta do cliente", "SPE separada", "Ainda n√£o definido", "Outro"],
                required: true
            },
            {
                id: "p3q5",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Tempo entre dep√≥sito e mint do token",
                type: "radio",
                options: ["Instant√¢neo", "At√© 1h", "At√© 1 dia √∫til", "+1 dia", "N√£o definido"],
                required: true
            },
            {
                id: "p3q6",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Existem limites de dep√≥sito?",
                type: "checkbox",
                options: ["M√≠nimo por transa√ß√£o", "M√°ximo por transa√ß√£o", "M√°ximo di√°rio", "Sem limites", "N√£o definido"],
                required: true
            },
            {
                id: "p3q7",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "\"Uso livre da stablecoin\" significa o qu√™ exatamente?",
                type: "checkbox",
                options: ["Transferir", "Pagar fornecedores", "Trocar ativos", "Usar em DeFi", "Pagamentos", "Outro"],
                required: true
            },
            {
                id: "p3q8",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Tokens de clientes diferentes podem interagir?",
                type: "radio",
                options: ["Sim", "N√£o", "Parcialmente", "N√£o sei", "Outro"],
                required: true
            },
            {
                id: "p3q9",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Onde o cliente final guardaria o token?",
                type: "checkbox",
                options: ["Carteira da empresa", "Carteira pr√≥pria", "Exchange", "N√£o definido", "Outro"],
                required: true
            },
            {
                id: "p3q10",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Como seria o processo de resgate dos reais?",
                type: "textarea",
                required: true
            },
            {
                id: "p3q11",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Tempo de liquida√ß√£o dos resgates",
                type: "radio",
                options: ["Instant√¢neo", "At√© 1h", "1 dia √∫til", "2 dias √∫teis", "+2 dias", "N√£o definido"],
                required: true
            },
            {
                id: "p3q12",
                part: "PARTE 3: SOLU√á√ÉO IMAGINADA",
                question: "Haver√° taxas? Se sim, quais?",
                type: "textarea",
                required: true
            },

            // PARTE 4: REQUISITOS REGULAT√ìRIOS
            {
                id: "p4q1",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "J√° mapearam requisitos regulat√≥rios brasileiros para emiss√£o de stablecoins?",
                type: "radio",
                options: ["Sim (completo)", "Parcialmente", "N√£o", "Estudando"],
                required: true
            },
            {
                id: "p4q2",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "J√° conversaram com advogados especializados em cripto/stablecoins?",
                type: "radio",
                options: ["Sim", "N√£o", "Planejamos em breve"],
                required: true
            },
            {
                id: "p4q3",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "Quem seria legalmente o emissor do token?",
                type: "radio",
                options: ["Empresa", "Cliente final", "Ambos", "N√£o sabemos", "Outro"],
                required: true
            },
            {
                id: "p4q4",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "Como funciona o KYC/AML hoje?",
                type: "textarea",
                required: true
            },
            {
                id: "p4q5",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "O KYC/AML mudaria com a emiss√£o de stablecoins?",
                type: "radio",
                options: ["Sim, muito", "Sim, um pouco", "N√£o mudaria", "N√£o sabemos"],
                required: true
            },
            {
                id: "p4q6",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "Quem seria respons√°vel pelo KYC do usu√°rio final?",
                type: "radio",
                options: ["Nossa empresa", "O cliente", "Compartilhado", "N√£o definido"],
                required: true
            },
            {
                id: "p4q7",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "√â necess√°rio ser institui√ß√£o de pagamento regulada pelo BC?",
                type: "radio",
                options: ["Sim", "N√£o", "N√£o sabemos", "Investigando"],
                required: true
            },
            {
                id: "p4q8",
                part: "PARTE 4: REQUISITOS REGULAT√ìRIOS",
                question: "Como seria o compliance de preven√ß√£o √† lavagem de dinheiro (PLD)?",
                type: "textarea",
                required: false
            },

            // PARTE 5: MODELO DE NEG√ìCIO
            {
                id: "p5q1",
                part: "PARTE 5: MODELO DE NEG√ìCIO",
                question: "Qual seria o modelo de receita da solu√ß√£o?",
                type: "checkbox",
                options: ["Setup fee", "Fee por transa√ß√£o", "Custody fee", "% sobre volume", "Outro", "N√£o definido"],
                required: true
            },
            {
                id: "p5q2",
                part: "PARTE 5: MODELO DE NEG√ìCIO",
                question: "Quantos clientes precisam usar para ser vi√°vel?",
                type: "text",
                required: false
            },
            {
                id: "p5q3",
                part: "PARTE 5: MODELO DE NEG√ìCIO",
                question: "Prazo esperado para lan√ßamento",
                type: "radio",
                options: ["1‚Äì3 meses", "3‚Äì6 meses", "6‚Äì12 meses", "+12 meses", "N√£o definido"],
                required: true
            },

            // PARTE 6: CASOS DE USO CONCRETOS
            {
                id: "p6q1",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "CLIENTE EXEMPLO 1: Descreva um cliente real/tipo de cliente",
                type: "textarea",
                required: true
            },
            {
                id: "p6q2",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 1] Segmento e tamanho",
                type: "text",
                required: true
            },
            {
                id: "p6q3",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 1] Para que usaria a stablecoin?",
                type: "textarea",
                required: true
            },
            {
                id: "p6q4",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 1] Frequ√™ncia de uso (transa√ß√µes/m√™s)",
                type: "text",
                required: false
            },
            {
                id: "p6q5",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 1] Volume financeiro mensal",
                type: "text",
                required: false
            },
            {
                id: "p6q6",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 1] Por que a solu√ß√£o atual n√£o serve?",
                type: "textarea",
                required: true
            },
            {
                id: "p6q7",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "CLIENTE EXEMPLO 2: outro cliente diferente",
                type: "textarea",
                required: false
            },
            {
                id: "p6q8",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 2] Segmento e tamanho",
                type: "text",
                required: false,
                dependsOn: "p6q7",
                dependsValue: "filled"
            },
            {
                id: "p6q9",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 2] Para que usaria a stablecoin?",
                type: "textarea",
                required: false,
                dependsOn: "p6q7",
                dependsValue: "filled"
            },
            {
                id: "p6q10",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[Cliente 2] Por que a solu√ß√£o atual n√£o serve?",
                type: "textarea",
                required: false,
                dependsOn: "p6q7",
                dependsValue: "filled"
            },
            {
                id: "p6q11",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "Qual exemplo √© mais urgente/importante? Por qu√™?",
                type: "textarea",
                required: true
            },
            {
                id: "p6q12",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "J√° t√™m clientes comprometidos a testar?",
                type: "radio",
                options: ["Sim (v√°rios)", "Sim (1‚Äì2)", "Interessados", "Ainda n√£o"],
                required: true
            },
            {
                id: "p6q13",
                part: "PARTE 6: CASOS DE USO CONCRETOS",
                question: "[SE SIM] Quantos e com que n√≠vel de comprometimento?",
                type: "textarea",
                required: false,
                dependsOn: "p6q12",
                dependsValue: ["Sim (v√°rios)", "Sim (1‚Äì2)"]
            }
        ];

        let currentQuestionIndex = 0;
        let answers = {};
        let visibleQuestions = [];

        // ====== INICIALIZA√á√ÉO ======
        function init() {
            loadFromLocalStorage();
            updateVisibleQuestions();
            renderQuestion();
            updateProgressBar();
        }

        // ====== LOCALSTORAGE ======
        function loadFromLocalStorage() {
            const saved = localStorage.getItem("stablecoinAnswers");
            const savedIndex = localStorage.getItem("stablecoinIndex");
            if (saved) {
                answers = JSON.parse(saved);
            }
            if (savedIndex) {
                currentQuestionIndex = parseInt(savedIndex);
            }
        }

        function saveToLocalStorage() {
            localStorage.setItem("stablecoinAnswers", JSON.stringify(answers));
            localStorage.setItem("stablecoinIndex", currentQuestionIndex);
        }

        // ====== L√ìGICA DE PERGUNTAS CONDICIONAIS ======
        function updateVisibleQuestions() {
            visibleQuestions = questions.filter(q => {
                if (!q.dependsOn) return true;

                const dependAnswer = answers[q.dependsOn];
                if (!dependAnswer) return false;

                if (q.dependsValue === "filled") {
                    return dependAnswer && dependAnswer.length > 0;
                }

                if (Array.isArray(q.dependsValue)) {
                    return q.dependsValue.includes(dependAnswer);
                }

                return dependAnswer === q.dependsValue;
            });

            // Ajusta √≠ndice se a pergunta atual n√£o est√° mais vis√≠vel
            if (currentQuestionIndex >= visibleQuestions.length) {
                currentQuestionIndex = Math.max(0, visibleQuestions.length - 1);
            }
        }

        // ====== RENDERIZA√á√ÉO ======
        function renderQuestion() {
            updateVisibleQuestions();

            if (currentQuestionIndex >= visibleQuestions.length) {
                showSuccessScreen();
                return;
            }

            const q = visibleQuestions[currentQuestionIndex];
            let html = `<div class="part-badge">${q.part}</div>`;
            html += `<div class="question-section">`;
            html += `<label class="question-label">${q.question}${q.required ? ' *' : ''}</label>`;

            if (q.type === "textarea") {
                html += `<textarea id="answer_${q.id}" placeholder="Digite sua resposta aqui...">${answers[q.id] || ""}</textarea>`;
                html += `<div class="error-message">Este campo √© obrigat√≥rio</div>`;
            } else if (q.type === "text") {
                html += `<input type="text" id="answer_${q.id}" placeholder="Digite sua resposta..." value="${answers[q.id] || ""}">`;
                html += `<div class="error-message">Este campo √© obrigat√≥rio</div>`;
            } else if (q.type === "number") {
                html += `<input type="number" id="answer_${q.id}" placeholder="Digite um n√∫mero..." value="${answers[q.id] || ""}">`;
                html += `<div class="error-message">Este campo √© obrigat√≥rio</div>`;
            } else if (q.type === "radio") {
                html += `<div class="options-group">`;
                q.options.forEach(option => {
                    const checked = answers[q.id] === option ? "checked" : "";
                    html += `
                        <div class="option-item">
                            <input type="radio" id="opt_${q.id}_${option}" name="q_${q.id}" value="${option}" ${checked}>
                            <label for="opt_${q.id}_${option}">${option}</label>
                        </div>
                    `;
                });
                html += `</div>`;
                html += `<div class="error-message">Selecione uma op√ß√£o</div>`;
            } else if (q.type === "checkbox") {
                html += `<div class="options-group">`;
                const selectedValues = answers[q.id] ? (Array.isArray(answers[q.id]) ? answers[q.id] : [answers[q.id]]) : [];
                q.options.forEach(option => {
                    const checked = selectedValues.includes(option) ? "checked" : "";
                    html += `
                        <div class="option-item">
                            <input type="checkbox" id="opt_${q.id}_${option}" name="q_${q.id}" value="${option}" ${checked}>
                            <label for="opt_${q.id}_${option}">${option}</label>
                        </div>
                    `;
                });
                html += `</div>`;
                html += `<div class="error-message">Selecione pelo menos uma op√ß√£o</div>`;
            }

            html += `</div>`;
            document.getElementById("questionContainer").innerHTML = html;

            // Atualizar bot√µes
            document.getElementById("btnPrevious").disabled = currentQuestionIndex === 0;
            document.getElementById("btnNext").textContent = currentQuestionIndex === visibleQuestions.length - 1 ? "Concluir ‚úì" : "Pr√≥xima ‚Üí";
        }

        // ====== VALIDA√á√ÉO ======
        function validateCurrentQuestion() {
            const q = visibleQuestions[currentQuestionIndex];
            if (!q.required) return true;

            const answerId = `answer_${q.id}`;
            const element = document.getElementById(answerId);
            const input = document.querySelector(`input[name="q_${q.id}"]:checked`);
            const checkboxes = document.querySelectorAll(`input[name="q_${q.id}"]:checked`);

            let isValid = false;
            let value = null;

            if (q.type === "textarea" || q.type === "text" || q.type === "number") {
                isValid = element && element.value.trim() !== "";
                value = element ? element.value.trim() : "";
                if (element) element.classList.toggle("field-error", !isValid);
            } else if (q.type === "radio") {
                isValid = input !== null;
                value = input ? input.value : null;
                if (element) {
                    const container = element.closest(".question-section");
                    if (container) container.classList.toggle("field-error", !isValid);
                }
            } else if (q.type === "checkbox") {
                isValid = checkboxes.length > 0;
                value = Array.from(checkboxes).map(c => c.value);
                if (element) {
                    const container = element.closest(".question-section");
                    if (container) container.classList.toggle("field-error", !isValid);
                }
            }

            if (isValid) {
                answers[q.id] = value;
            }

            return isValid;
        }

        // ====== NAVEGA√á√ÉO ======
        function nextQuestion() {
            if (!validateCurrentQuestion()) return;

            saveToLocalStorage();
            currentQuestionIndex++;
            renderQuestion();
            updateProgressBar();
            window.scrollTo(0, 0);
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                saveToLocalStorage();
                currentQuestionIndex--;
                renderQuestion();
                updateProgressBar();
                window.scrollTo(0, 0);
            }
        }

        // ====== PROGRESSO ======
        function updateProgressBar() {
            const total = visibleQuestions.length;
            const current = currentQuestionIndex + 1;
            const percentage = (current / total) * 100;

            document.getElementById("progressText").textContent = `Pergunta ${current} de ${total}`;
            document.getElementById("progressPercent").textContent = `${Math.round(percentage)}%`;
            document.getElementById("progressFill").style.width = `${percentage}%`;
        }

        // ====== TELA DE SUCESSO ======
        function showSuccessScreen() {
            document.getElementById("formScreen").style.display = "none";
            document.getElementById("successScreen").classList.add("active");
        }

        // ====== DOWNLOAD CSV ======
        function downloadCSV() {
            try {
                // Cabe√ßalho com separa√ß√£o clara
                let csv = "Stablecoin Discovery Questionnaire - Respostas\n";
                csv += `Data de Preenchimento,${new Date().toLocaleString('pt-BR')}\n\n`;
                csv += "Pergunta,Resposta\n";

                // Adicionar todas as respostas
                questions.forEach(q => {
                    const answer = answers[q.id] || "(N√£o respondida)";
                    const answerStr = Array.isArray(answer) ? answer.join("; ") : answer;

                    // Escapar aspas duplas para CSV
                    const escapedQuestion = `"${q.question.replace(/"/g, '""')}"`;
                    const escapedAnswer = `"${answerStr.replace(/"/g, '""')}"`;

                    csv += `${escapedQuestion},${escapedAnswer}\n`;
                });

                // Criar blob e download
                const BOM = '\uFEFF'; // UTF-8 BOM para Excel abrir corretamente
                const blob = new Blob([BOM + csv], {
                    type: "text/csv;charset=utf-8;"
                });

                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);

                link.setAttribute("href", url);
                link.setAttribute("download", `stablecoin-respostas-${new Date().getTime()}.csv`);
                link.style.visibility = "hidden";

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Liberar mem√≥ria
                URL.revokeObjectURL(url);

            } catch (error) {
                console.error("Erro ao gerar CSV:", error);
                alert("Erro ao baixar o arquivo. Tente novamente.");
            }
        }

        // ====== REINICIAR ======
        function restartForm() {
            localStorage.removeItem("stablecoinAnswers");
            localStorage.removeItem("stablecoinIndex");
            answers = {};
            currentQuestionIndex = 0;
            document.getElementById("successScreen").classList.remove("active");
            document.getElementById("formScreen").style.display = "block";
            init();
        }

        // Inicializar ao carregar
        window.onload = init;
    </script>
</body>
</html>